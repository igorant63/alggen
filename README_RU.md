# README

## Algoritm Generator (alggen) 1.03

Algoritm Generator предназначен для эволюционного моделирования синтеза программного кода и алгоритмов решения прикладных задач.
Программа реализована на языке C++ с использованием библиотеки MFC как Windows-приложение на основе диалогового окна. 

## Сборка проекта 

Открыть в Visual Studio 2022 файл решения algen.sln и выполнить сборку проекта.
Конкретные задачи реализуются в виде динамических библиотек DLL, файлы которых должны размещаться в папке файла приложения alggen.exe.
Задача сортировки массива чисел реализована в решении dll.sln. После сборки файл dll.dll следует скопировать в папку с файлом alggen.exe.

## Управление приложением

В окне приложения отображается меню, панель вывода текста программы, кнопки управления и строка состояния. 

Команды меню
Раздел Population
"Create" генерирует исходную популяцию программ.
"Save" сохраняет текущую популяцию в файле с расширением .pop.
"Load" загружает сохраненную популяцию из файла с расширением .pop.
"Merge" объединяет текущую популяцию с загружаемой из файла популяцией.
"Sort" упорядочивает программы в соответствии с настройками оптимизации.
"Selection" удаляет из популяции программы с показателем качества ниже заданного.
"Cut" удаляет из популяции программы с порядковым номером выше заданного.
"Reset" очищает список программ.
Раздел Program 
"New" добавляет новую пустую программу.
"Remove" удаляет текущую отображаемую программу.
"Add Command" добавляет команду в конец программы
"Remove Command" удаляет последнюю команду в программе.
Раздел Settings
"Select test" отображает панель выбора модуля DLL для решения определенной задачи.
"Save settings" сохраняет настройки в файл с указанным именем.
"Load settings" загружает настройки из выбранного файла.
"Command probabilities"  отображает  панель настроек вероятностей выбора отдельных групп команд при генерации программы.
"Mutation probabilities"  отображает  панель настроек вероятностей мутаций различного типа.
"Population size"  отображает  панель настроек размера популяции и длины автоматически генерируемых программ.
"Optimization"  отображает  панель настроек опций оптимизации в процессе генерации и отбора программ.

Команды кнопок главного окна
"List" отображает список программ с их параметрами.
"Prev"/"Next" осуществляет переход на предыдущую/следующую программу в списке.
"Start/Stop" запускает циклический процесс мутаций и отбора.
"Step" выполняет мутирование и отбор для одного поколения программ.
"View CPU" отображает содержание первых 16 ячеек оперативной памяти и регистров процессора до и после выполнения выбранной программы.
"Sample" добавляет в список пример программы, реализующей задачу сортировки массива чисел в памяти.
"Test" проверяет и отображает в строке состояния  статус выбранной программы (исправна или прерывается по ошибке), её показатель качества (QUALITY), а также показатель качества исходного массива (ORIG.QUAL) и максимально достижимый показатель качества (MAX.QUAL).
"Test All" проверяет работоспособность всех программ популяции и отображает в строке состояния  статистику о числе формально исправных программ и программ, содержащих ошибки зацикливания и доступа к памяти.
"Exit" завершает работу приложения.

## Использование приложения

После запуска можно выбрать нужный модуль решения задачи ("Settings"-"Select test"), если установлены дополнительные задачи. Затем в разделе меню "Settings" следует настроить параметры генерации кода программы, параметры мутаций и опции оптимизации. 
Файл sort.set содержит настройки, обеспечивающие успешный синтез алгоритма сортировки. Чтобы он был доступен через загрузку настроек в меню, его следует скопировать в папку с исполняемым файлом alggen.exe.
После настройки командой "Start" запускается процесс эволюции, который может быть остановлен командой "Stop" по достижении требуемого показателя качества. Программы итоговой популяции, их показатели и результаты выполнения можно просмотреть и сохранить текущую популяцию на диск. В процессе выполнения эволюционного моделирования в строке состояния отображается время обработки одного поколения программ, общее число мутаций и максимальный достигнутый показатель качества. 
После остановки моделирования в режиме просмотра программ после нажатия кнопки "Test" в строке состояния отображается статус выбранной программы (исправна или прерывается по ошибке), её показатель качества (QUALITY), а также показатель качества исходного массива (ORIG.QUAL) и максимально достижимый показатель качества (MAX.QUAL). 
Более подробную информацию о параметрах программ популяции можно получить по команде "List". По этой команде отображается список программ текущей популяции со следующими характеристиками:
Signature - уникальный идентификатор автоматически сгенерированной программы, потомком которой является данная программа.
Age - номер поколения, в котором была сформирована данная программа.
Status - GOOD, если программа завершается без ошибок зацикливания или доступа к памяти.
Quality - показатель качества программы (значение фитнес-функции).
Delta Q - приращение качества данной программы по отношению к показателю качества исходного массива данных.
Length - длина программы в операторах.
Takts - число операций до завершения программы.

## Комментарии к коду приложения

Mодель виртуальной вычислительной среды реализована как набор взаимодействующих объектов языка С++. 
Объекты модели 
Процессор  ( память + регистры) - struct proc.
Машинная команда - struct command.
Программа - struct program. 
Таблицы параметров - struct maps.

В программе создаётся одна глобальная переменная processor, используемая для моделирования выполнения программы. В текущей реализации процессора используется 256 4-х байтовых ячеек оперативной памяти и 5 регистров общего назначения.
Команда содержит два операнда, используемых при вычислениях – op_1, op_2 , и метку – label. 
Методом print команда формирует свой листинг, методом run выполняет свою операцию в переданном её в качестве аргумента процессоре.
Набор команд, реализующих конкретную систему команд, создаётся как набор производных от класса command классов - jle_r_r, add_r_c, и т.д..

Программа включает в себя в себе конкретный набор команд - cmds, счётчик команд - cp, ссылку на процессор на котором она выполняется - prc.
Метод gen_prog генерирует случайный набор команд, представляющий новую программу.
Метод gen_sample генерирует шаблонный пример рабочей программы.
Метод run выполняет программу.
Метод listing выводит текст программы на устройство вывода.

Команды организуются в группы, пропорции вероятностей выпадения настраиваются в диалоговой панели. 
Внутри группы выпадение каждой команды равновероятно. Можно все команды объединить в одну группу, и они станут равновероятными. Можно каждую команду сделать отдельной группой и настраивать ей индивидуально вероятность выпадения.
В таблице настроек map – массив из ста ячеек, содержащий пропорциональное вероятности каждой группы команд число ячеек с индексом этой группы. Случайный выбор одного из ста этих элементов обеспечивает нужную вероятность выпадения группы в последовательности испытаний.
Функция init_map заполняет массив map.
Функция def_prob задаёт вероятности для каждой группы команд.
Функция make_command генерирует отдельную команду для конкретной формируемой программы с учётом настроек вероятностей групп и с учётом равновероятности команд внутри группы.
Функция make_array инициализирует процессор перед выполнением программы.

Переход к новой модели организации процессора требует реорганизации класса proc, переход к новой системе команд – реорганизации набора классов, производных от command, а также реорганизации функции make_command и согласованной корректировки следующих массивов и переменных:
int prob[]; // Распределение вероятностей по типам настраиваемых команд
int n_comm; // Число настраиваемых групп команд
int n_comm_tot; // Общее число различных типов команд
int group[]; // Число команд в каждой настраиваемой группе команд

Модули решения задачи загружаются из динамических библиотек (*.dll), размещаемых в папке приложения. Набор модулей может быть расширен самостоятельно. Исходный код модуля сортировки массива доступен как проект DLL.

DLL модуля решения задачи должна экспортировать следующие функции:

int check_alg(base_check *); 
Функция получает указатель на структуру base_check, функции которой get_mem() и get_reg() возвращают указатели на память и регистры процессора. Функция должна инициализировать память и регистры процессора, вызвать функцию run() структуры base_check для выполнения программы и после этого вычислить и вернуть значение фитнес-функции. 
int get_max_qual();
Функция возвращает максимально возможное значение фитнес-функции для текушей задачи.
int get_base_qual();
Функция возвращает базовое значение фитнес-функции для исходного состояния памяти до выполнения программы.
int* get_reg_one();
Функция возвращает указатель на массив, содержащий исходное состояние регистров процессора.
int * get_mem_one();
Функция возвращает указатель на массив, содержащий исходное состояние оперативной памяти процессора.
void init_array();
Функция обновляет массивы исходных данных для решения задачи.
char*  about();
Функция возвращает указатель на текст с описанием данного модуля.

## Лицензия

Код этого проекта распространяется под лицензией MIT.
* Copyright (C) Игорь Антонов igor_a_2000@mail.ru